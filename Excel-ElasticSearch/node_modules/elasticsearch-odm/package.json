{
  "name": "elasticsearch-odm",
  "version": "0.3.0",
  "description": "Like Mongoose but for Elasticsearch. Define models, preform CRUD operations, and build advanced search queries.",
  "main": "index.js",
  "scripts": {
    "test": "NODE_ENV=test ./node_modules/.bin/mocha --check-leaks ./tests/**.js"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/zackiles/elasticsearch-odm.git"
  },
  "keywords": [
    "elasticsearch",
    "elastic",
    "odm",
    "orm",
    "database",
    "model",
    "query",
    "search",
    "driver",
    "client",
    "es",
    "promise",
    "bulk",
    "mapping"
  ],
  "author": {
    "name": "Zachary Iles",
    "email": "zack.iles@gmail.com"
  },
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/zackiles/elasticsearch-odm/issues"
  },
  "homepage": "https://github.com/zackiles/elasticsearch-odm#readme",
  "dependencies": {
    "bluebird": "~2.9.34",
    "dot-object": "^1.1.0",
    "elasticsearch": "~8.0.1",
    "kareem": "^1.0.1",
    "lodash": "~3.10.1",
    "pluralize": "~1.1.6",
    "winston": "~1.0.1"
  },
  "devDependencies": {
    "benchmark": "^1.0.0",
    "mocha": "^2.3.0",
    "should": "^7.1.0"
  },
  "readme": "Elasticsearch ODM\n=========\n[![npm version](https://badge.fury.io/js/elasticsearch-odm.svg)](http://badge.fury.io/js/elasticsearch-odm)\n\n***Like Mongoose but for Elasticsearch.*** Define models, preform CRUD operations, and build advanced search queries. Most commands and functionality that exist in Mongoose exist in this library. All asynchronous functions use Bluebird Promises instead of callbacks.\n\nThis is currently the only ODM/ORM library that exists for Elasticsearch on Node.js. [Waterline](https://github.com/balderdashy/waterline) has a [plugin](https://github.com/UsabilityDynamics/node-waterline-elasticsearch) for Elasticsearch but it is incomplete and doesn't exactly harness it's searching power.\n[Loopback](https://github.com/strongloop/loopback) has a storage [plugin](https://github.com/drakerian/loopback-connector-elastic-search), but it also doesn't focus on important parts of Elasticsearch, such as mappings and efficient queries. This library automatically handles merging and updating Elasticsearch mappings based on your schema definition.\n\n### Installation\n\nIf you currently have [npm elasticsearch](https://www.npmjs.com/package/elasticsearch) installed, you can remove it and access it from [client](client---elasticsearch) in this library if you still need it.\n\n```sh\n$ npm install elasticsearch-odm\n```\n\n### Features\n- Easy to use API that mimics Mongoose, but cuts out the extras.\n- Models, Schemas and Elasticsearch specific type mapping.\n- Add Elasticsearch specific type options to your [Schema](#schemas), like boost, analyzer or score.\n- Utilizes bulk and scroll features from Elasticsearch when needed.\n- Easy [search queries](#query-options) without generating your own DSL.\n- Seamlessly handles updating your Elasticsearch mappings based off your models [Schema](#schemas).\n\n### Quick Start\nYou'll find the API is intuitive if you've used Mongoose or Waterline.\n\nExample (no schema):\n\n```js\nvar elasticsearch = require('elasticsearch-odm');\nvar Car = elasticsearch.model('Car');\nvar car = new Car({\n  type: 'Ford', color: 'Black'\n});\nelasticsearch.connect('my-index').then(function(){\n  // be sure to call connect before bootstrapping your app.\n  car.save().then(function(document){\n    console.log(document);\n  });\n});\n```\nExample (using a [schema](#schemas)):\n\n```js\nvar elasticsearch = require('elasticsearch-odm');\nvar carSchema = new elasticsearch.Schema({\n  type: String,\n  color: {type: String, required: true}\n});\nvar Car = elasticsearch.model('Car', carSchema);\n```\n## API Reference\n- [Core](#core)\n  - [`.connect(String/Object options)`](#connectstringobject-options---promise)\n  - [`new Schema(Object options)`](#new-schemaobject-options---schema)\n  - [`.model(String modelName)`](#modelstring-modelname-optionalschema-schema---model)\n  - [`.client`](#client---elasticsearch)\n  - [`.stats()`](#stats)\n  - [`.createIndex(String index, Object mappings)`](#createindexstring-index-object-mappings)\n  - [`.removeIndex(String index)`](#removeindexstring-index)\n- [Document](#document)\n  - [`.save()`](#save-document)\n  - [`.remove()`](#remove)\n  - [`.update(Object data)`](#updateobject-data---document)\n  - [`.set(Object data)`](#setobject-data---document)\n  - [`.toObject()`](#toobject)\n- [Model](#model)\n  - [`.count()`](#count---object)\n  - [`.create(Object data)`](#createobject-data---document)\n  - [`.update(String id, Object data)`](#updatestring-id-object-data---document)\n  - [`.remove(String id)`](#removestring-id)\n  - [`.removeByIds(Array ids)`](#removebyidsarray-id)\n  - [`.set(String id)`](#setstring-id-object-data---document)\n  - [`.find(Object/String match, Object queryOptions)`](#findobjectstring-match-object-queryoptions---document)\n  - [`.findById(String id, Object queryOptions)`](#findbyidstring-id-object-queryoptions---document)\n  - [`.findByIds(Array ids, Object queryOptions)`](#findbyidsarray-ids-object-queryoptions---document)\n  - [`.findOne(Object/String match, Object queryOptions)`](#findoneobjectstring-match-object-queryoptions---document)\n  - [`.findAndRemove(Object/String match, Object queryOptions)`](#findandremoveobjectstring-match-object-queryoptions---object)\n  - [`.findOneAndRemove(Object/String match, Object queryOptions)`](#findoneandremoveobjectstring-match-object-queryoptions---object)\n  - [`.makeInstance(Object data)`](#makeinstanceobject-data---document)\n  - [`.toMapping()`](#tomapping)\n- [Query Options](#query-options)\n  - [`page & per_page`](#page--per_page)\n  - [`fields`](#fields)\n  - [`sort`](#sort)\n  - [`q`](#q)\n  - [`must`](#must)\n  - [`not`](#mot)\n  - [`missing`](#missing)\n  - [`exists`](#exists)\n- [Schemas](#schemas)\n  - [`Hooks and Middleware`](#hooks-and-middleware)\n  - [`Static and Instance Methods`](#static-and-instance-methods)\n\n### Core\nCore methods can be called directly on the Elasticsearch ODM instance. These include methods to configure, connect, and get information from your Elasticsearch database. Most methods act upon the [official Elasticsearch client](https://www.npmjs.com/package/elasticsearch).\n\n##### `.connect(String/Object options)` -> `Promise`\nReturns a promise that is reolved when the connection is complete. Can be passed a single index name, or a full configuration object. The default host is localhost:9200 when no host is provided, or just an index name is used.\nThis method should be called at the start of your application.\n\n***If the index name does not exist, it is automatically created for you.***\n\n*You can also add any of the [Elasticsearch specific options](https://www.elastic.co/guide/en/elasticsearch/client/javascript-api/current/configuration.html), like SSL configs.*\n\nExample:\n\n```js\n// when bootstrapping your application\nvar elasticsearch = require('elasticsearch-odm');\n\nelasticsearch.connect({\n  host: 'localhost:9200',\n  index: 'my-index',\n  logging: false, // true by default when NODE_ENV=development\n  ssl: {\n    ca: fs.readFileSync('./cacert.pem'),\n    rejectUnauthorized: true\n  }\n});\n// OR\nelasticsearch.connect('my-index'); // default host localhost:9200\n```\n\n##### `new Schema(Object options)` -> `Schema`\nReturns a new schema definition to be used for models.\n\n##### `.model(String modelName, Optional/Schema schema)` -> `Model`\nCreates and returns a new Model, like calling Mongoose.model(). Takes a type name, in mongodb this is also known as the collection name. This is global function and adds the model to Elasticsearch ODM instance.\n\n##### `.client` -> `Elasticsearch`\nThe raw instance to the underlying [Elasticsearch](https://www.npmjs.com/package/elasticsearch) client. Not really needed, but it's there if you need it, for example to run queries that aren't provided by this library.\n\n##### `.stats()`\nReturns a promise that is resolved with [index stats](https://www.elastic.co/guide/en/elasticsearch/reference/1.6/indices-stats.html) for the current Elasticsearch connections.\n\n##### `.removeIndex(String index)`\nTakes an index name, and complete destroys the index. Resolves the promise when it's complete.\n\n##### `.createIndex(String index, Object mappings)`\nTakes an index name, and a json string or object representing your [mapping](https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html).\nResolves the promise when it's complete.\n\n### Document\nLike Mongoose, instances of models are considered documents, and are returned from calls like find() & create(). Documents include the following functions to make working with them easier.\n\n##### `.save()` -> `Document`\nSaves or updates the document. If it doesn't exist it is created. Like Mongoose, Elasticsearches internal '_id' is copied to 'id' for you. If you'd like to force a custom id, you can set the id property to something before calling save(). Every document gets a createdOn and updatedOn property set with ISO-8601 formatted time.\n\n##### `.remove()`\nRemoves the document and destroys the cuurrent document instance. No value is resolved, and missing documents are ignored.\n\n##### `.update(Object data)` -> `Document`\nPartially updates the document. Data passed will be merged with the document, and the updated version will be returned. This also sets the current model instance with the new document.\n\n##### `.set(Object data)` -> `Document`\nCompletely overwrites the document with the data passed, and returns the new document. This also sets the current model instance with the new document.\n\n*Will remove any fields in the document that aren't passed.*\n\n##### `.toObject()`\nLike Mongoose, strips all non-document properties from the instance and returns a raw object.\n\n### Model\nModel definitions returned from .model() in core include several static functions to help query and manage documents. Most functions are similar to Mongoose, but due to the differences in Elasticsearch, querying includes some extra advanced features.\n\n##### `.count()` -> `Object`\nObject returned includes a 'count' property with the number of documents for this Model (also known as _type in Elasticsearch). See [Elasticsearch count](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-count.html).\n\n##### `.create(Object data)` -> `Document`\nA helper function. Similar to calling new Model(data).save(). Takes an object, and returns the new document.\n\n##### `.update(String id, Object data)` -> `Document`\nA helper function. Similar to calling new Model().update(data). Takes an id and a partial object to update the document with.\n\n##### `.remove(String id)`\nRemoves the document by it's id. No value is resolved, and missing documents are ignored.\n\n##### `.removeByIds(Array ids)`\nHelp function, see remove. Takes an array of ids.\n\n##### `.set(String id, Object data)` -> `Document`\nCompletely overwrites the document matching the id with the data passed, and returns the new document.\n\n*Will remove any fields in the document that aren't passed.*\n\n##### `.find(Object/String match, Object queryOptions)` -> `Document`\nThere are four ways to call .find() and it's siblings. You can mix and match styles.\n- Passing only a match object like `.find({name:'Joe'})`\n- Passing only a string to match against all document fields `.find('some string')`\n- Passing [Query Options](#query-options) (match can be set to null/empty) `.find({}, {must: {active: true, sort: 'createdOn'}}}`\n- Use chaining options (alias for QueryOptions) `.find({}).must({active: true}).sort('createdOn').then(..)`\n\nUnlike mongoose, finding exact matches requires the fields in your mapping to be set to 'not_analyzed'. By default `{index: not_analyzed}` is added to all string fields in your Schema unless you override it.\n*Depending on the [analyzer](https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-analyzers.html) in your [mapping](https://www.elastic.co/guide/en/elasticsearch/guide/current/mapping-intro.html), find queries like must, not, and matches may not find any results.*\n\nmatch => Optional. An alias for the 'must' Query Option.  Like Mongoose this matches name/value in documents. Also, instead of an object, just a string can be passed which will match against all document fields using the power of an Elasticsearch [QueryStringQuery](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html).\n\nqueryOptions => Optional (can also use chaining instead). An object with Query Options. Here you can specifiy paging, filtering, sorting and other advanced options. [See here for more details](#query-options). You can set the first argument to null, and only use filters from the query options if you wanted.\n\nreturns => Found documents, or null if nothing was found.\n\nExample:\n\n```js\nvar Car = elasticsearch.model('Car');\n\n// Simple query.\nCar.find({color: 'blue'}).then(function(results){\n  console.log(results);\n});\n\n// Nested query (for nested documents/properties).\nCar.find({'location.city': 'New York'})\n\n// Find all by passing null or empty object to first argument\nCar.find(null, {sort: 'createdOn'})\n\n// Search all fields using a QueryStringQuery.\nCar.find('some text')\n\n// Chained query without using Query Options.\n// Instead of Mongoose .exec(), we call .then()\nCar.find()\n.must({color: 'blue'})\n.exists('owner')\n.sort('createdOn')\n.then(...)\n\n```\n##### `.findById(String id, Object queryOptions)` -> `Document`\nFinds a document by id. 'fields' argument is optional and specifies the fields of the document you'd like to include.\n\n##### `.findByIds(Array ids, Object queryOptions)` -> `Document`\nSame as .findById() but for multiple documents.\n\n##### `.findOne(Object/String match, Object queryOptions)` -> `Document`\nSame arguments as .find(). Returns the first matching document.\n\n##### `.findAndRemove(Object/String match, Object queryOptions)` -> 'Object'\nSame arguments as .find(). Removes all matching documents and returns their raw objects.\n\n##### `.findOneAndRemove(Object/String match, Object queryOptions)` -> 'Object'\nSame arguments as .findAndRemove(). Removes the first found document.\n\n##### `.makeInstance(Object data)` -> `Document`\nHelper function. Takes a raw object and creates a document instance out of it. The object would need at least an id property. The document returned can be used normally as if it were returned from other calls like .find().\n\n##### `.toMapping()`\nReturns a complete Elasticsearch mapping for this model based off it's schema. If no schema was used, it returns nothing. Used internally, but it's there if you'd like it.\n\n### Query Options\nThe query options object includes several options that are normally included in mongoose chained queries, like sort, and paging (skip/limit), and also some advanced features from Elasticsearch.\nThe Elasticsearch [Query](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html) and [Filter](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-filters.html) DSL is generated using best practices.\n\n##### page & per_page\nType: `Integer`\n\nFor most use cases, paging is better suited than skip/limit, so this library includes thhis instead. Page 0/1 are the same thing, so either can be used. Page and per_page both use default when the other is set, page defaults to the first, and per_page defaults to 10.\n\n*Including page or per_page will result in the response being wrapped in a meta data object like the following. You can call toJSON and toObject on this response and it'll call that method on all document instances under the hits property.*\n\n```js\n// A paged response that is returned when page or per_page is set.\n{\n  total: 0, // total documents found for the query.\n  hits: [], // a collection of document instances.\n  page: 0, // current page requested.\n  pages: 0 // total number of pages.\n}\n```\n\n##### fields\nType: `Array or String`\n\nA list of fields to include in the documents returned. For example, you could pass 'id' to only return the matching document id's. See [Elasticsearch Fields](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-fields.html).\n\n```js\n// Query Options.\n{\n  fields: ['name', 'age']\n}\n\n// Chained Query.\n.find()\n.fields(['name', 'age'])\n.then(...)\n```\n\n##### sort\nType: `Array or String`\n\nA list of fields to sort on. If multiple fields are passed then they are executed in order. Adding a '-' sign to the start of the field name makes it sort descending. Default is ascending. See [Elasticsearch Sort](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-sort.html).\n\nExample:\n\n```js\n// Query Options.\n{\n  sort: ['name', 'createdOn']\n}\n\n// Chained Query.\n.find()\n.sort(['name', 'createdOn'])\n.then(...)\n```\n\n##### q\nType: `String`\n\nA string to search all document fields with using Elasticsearch [QueryStringQuery](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html). This can be expensive, so use it sparingly.\n\nExample:\n\n```js\n// Query Options.\n{\n  q: 'Red dog run'\n}\n\n// Chained Query.\n.find('Red dog run')\n.then(...)\n```\n\n##### must\nType: `Object`\n\nKey value pairs to match documents against. Essentially it's the same as first argument passed to Mongoose .find(). This is also an alias to the first argument passed to .find() in this library.\nThis is a 'must' [Bool Filter](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-filter.html).\n\n***Elasticsearches internal [Tokenizers](https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenizers.html) are used, and fields are analyzed.***\n\n*You can query nested fields using dot notation.*\n\nExample:\n\n```js\n// Query Options.\n{\n  must: {\n    name: 'Jim',\n    'location.country': 'Canada'\n  }\n}\n\n// Chained Query.\n.find()\n.must({name: 'Jim', 'location.country': 'Canada'})\n.then(...)\n```\n##### not\nType: `Object`\n\nThe same as [must](#must), but matches documents where the key value pairs DON'T match.\nThis is a 'must_not' [Bool Filter](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-filter.html) query.\n\n*You can query nested fields using dot notation.*\n\nExample:\n\n```js\n// Query Options.\n{\n  not: {\n    name: 'Jim',\n    'location.country': 'Canada'\n  }\n}\n\n// Chained Query.\n.find()\n.not({name: 'Jim', 'location.country': 'Canada'})\n.then(...)\n```\n##### missing\nType: `Array or String`\n\nA single field name, or array of field names. Matches documents where these field names are missing. A field is considered mising, when it is null, empty, or does not exist. See [MissingFilter]\n(https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-missing-filter.html).\n\nExample:\n\n```js\n// Query Options.\n{\n  missing: ['description', 'name']\n}\n\n// Chained Query.\n.find()\n.missing(['description', 'name'])\n.then(...)\n```\n##### exists\nType: `Array or String`\n\nA single field name, or array of field names. Matches documents where these field names exists. The opposite of [missing](#missing).\n\nExample:\n\n```js\n// Query Options.\n{\n  exists: ['description', 'name']\n}\n\n// Chained Query.\n.find()\n.exists(['description', 'name'])\n.then(...)\n```\n\n### Schemas\nModels don't require schemas, but it's best to use them - especially if you'll be making search queries. Elasticsearch-odm will generate and update Elasticsearch with the proper mappings based off your schema definition.\nThe schemas are similar to Mongoose, but several new field types have been added which Elasticsearch supports. These are; **float**, **double**, **long**, **short**, **byte**, **binary**, **geo_point**. Generally for numbers, only the Number type is needed (which converts to Elasticsearch integer). You can read more about Elasticsearch types [here](https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-core-types.htm).\n\n***NOTE***\n\n- Types can be defined in several ways. The regular mongoose types exist, or you can use the actual type names Elasticsearch uses.\n- You can also add any of the field options you see for [Elasticsearch Core Types](https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-core-types.html)\n- String types will default to `\"index\": \"not_analyzed\"`. See [Custom Field Mappings](https://www.elastic.co/guide/en/elasticsearch/guide/current/mapping-intro.html#custom-field-mappings). This is so the .find() call acts like it does in Mongoose by only fidning exact matches, however, this prevents the ability to do full text search on this field. Simply set `{\"index\":\"analyzed\"}` if you'd like full text search instead.\n\nExample:\n```js\n// Before saving a document with this schema, your Elasticsearch\n// mappings will automatically be updated.\n\n// Note the various ways you can define a schema field type.\nvar carSchema = new elasticsearch.Schema({\n  // native type without options\n  available: Boolean,\n  // Elasticsearch type without options\n  safteyRating: 'float',\n  // native array type\n  parts: [String],\n  // Elasticsearch array type\n  oldPrices: {type: ['double']},\n  // with options\n  color: {type: String, required: true},\n  // a field named 'type' must be defined like the following.\n  type: {type: String},\n  // nested document\n  owner: {\n    name: String,\n    age: Number,\n    // force a required field\n    location: {type: 'geo_point', required: true}\n  },\n  // nested document array\n  inspections: [{\n    date: Date,\n    grade: Number\n  }],\n  // Enable full-text search of this field.\n  // NOTE: it's better to than use the 'q' paramater in queryOptions\n  // during searches instead of must/not or match when using 'analyzed'\n  description: {type:String, index: 'analyzed'}\n\n  // Ignore_malformed is an Elasticsearch Core Type field option for numbers\n  price: {type: 'double', ignore_malformed: true}\n});\n```\n#### Hooks and Middleware\nSchemas include pre and post hooks that function similar to Mongoose. Currently, there are pre/post hooks for 'save' and 'remove'.\n\n**Pre Hooks**\n\nSame conventions as Mongoose. Function takes a done() callback that must be called when your function is finished. `this` is scoped to the current document. assing an Error to done() will cancel the current operation. For example, in a pre 'save' hook, passing an error to done() will cause the document not to be saved and will return your error to the save() callers rejection handler.\n\n```js\nvar schema = new elasticsearch.Schema(...);\nschema.pre('save', function(done){\n  console.log(this); // this = the current document\n  done(); // OR done(new Error('bad document'));\n});\n```\n\n**Post Hooks**\n\nSame conventions as Mongoose. Does not have a done() callback. Executed after the hooked method. The first argument is the current document which may or may not be a document instance (eg. post remove only receives the raw object as the document no longer exists).\n\n```js\nvar schema = new elasticsearch.Schema(...);\nschema.post('remove', function(document){\n  console.log(document);\n});\n```\n\n#### Static and Instance Methods\n\nAdd methods to your schema with the same convention as Mongoose.\n\n```js\n// Instance method.\nvar schema = new elasticsearch.Schema(...);\n\nschema.methods.getFullName = function(){\n  return this.firstName + ' ' + this.lastName;\n});\n\n// Static method.\nschema.statics.findByColor = function(color){\n  return this.find({color: color});\n});\n```\n\n### CHANGLELOG\n[See here.](https://github.com/zackiles/elasticsearch-odm/blob/master/CHANGELOG.md)\n\n### CONTRIBUTING\nThis is a library Elasticsearch desperately needed for Node.js. Currently the official npm [elasticsearch](https://www.npmjs.com/package/elasticsearch) client has about 23,000 downloads per week, many of them would benefit from this library instead. Pull requests are welcome. There are [Mocha](https://github.com/mochajs/mocha) and [benchmark](https://www.npmjs.com/package/benchmark) tests in the root directory.\n\n### TODO\n- Browser build.\n- Add support for [querying nested document arrays](https://www.elastic.co/guide/en/elasticsearch/guide/current/nested-query.html) with dot notation syntax.\n- Add [scrolling](https://www.elastic.co/guide/en/elasticsearch/reference/1.6/search-request-scroll.html)\n- Add a wrapper to enable streaming of document results.\n- Add [snapshots/backups](https://www.elastic.co/guide/en/elasticsearch/reference/1.6/modules-snapshots.html)\n- Allow methods to call Elasticsearch facets.\n- Performance tweak application, fix garbage collection issues, and do benchmark tests.\n- Integrate npm 'friendly' for use with expanding/collapsing parent/child documents.\n- Use [source filtering](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-get.html#get-source-filtering) instead of fields.\n",
  "readmeFilename": "README.md",
  "_id": "elasticsearch-odm@0.3.0",
  "dist": {
    "shasum": "58a0519efe7b121a5dcfa6521db4202da6ade8f5"
  },
  "_from": "elasticsearch-odm@",
  "_resolved": "https://registry.npmjs.org/elasticsearch-odm/-/elasticsearch-odm-0.3.0.tgz"
}
